<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Auto Handoff - Assets</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      font-size: 11px;
      color: #1c1917;
      background: #fafaf9;
      padding: 16px;
      height: 600px;
      overflow-y: auto;
    }

    /* Section Headers */
    .section-header {
      font-size: 10px;
      font-weight: 600;
      color: #78716c;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 8px;
      margin-top: 20px;
    }

    .section-header:first-child {
      margin-top: 0;
    }

    /* Asset Buttons Grid */
    .asset-buttons {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
      margin-bottom: 10px;
    }

    .asset-buttons.pointers-grid {
      grid-template-columns: repeat(4, 1fr);
    }

    .asset-btn {
      background: #ffffff;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 6px;
      padding: 12px 8px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .asset-btn:hover {
      background: #f5f5f4;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .asset-btn.active {
      background: #dbeafe;
      border-color: #4668FF;
    }

    .asset-btn-icon {
      font-size: 20px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .asset-btn-label {
      font-size: 9px;
      color: #57534e;
    }

    /* Controls Row */
    .controls-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 10px;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .control-label {
      font-size: 9px;
      color: #78716c;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .control-select,
    .control-input {
      padding: 7px 10px;
      font-size: 11px;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 4px;
      background: #ffffff;
      color: #1c1917;
    }

    .control-select:focus,
    .control-input:focus {
      outline: none;
      border-color: #4668FF;
      box-shadow: 0 0 0 2px rgba(70, 104, 255, 0.1);
    }

    /* Color Picker Row */
    .color-picker-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .color-preview {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      flex-shrink: 0;
    }

    .color-input-wrapper {
      display: none;
      flex: 1;
    }

    .color-input-wrapper.visible {
      display: block;
    }

    .color-hex-input {
      width: 100%;
      padding: 5px 8px;
      font-size: 10px;
      font-family: 'SF Mono', Monaco, monospace;
      text-transform: uppercase;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 4px;
    }

    /* Apoio Compact Section */
    .apoio-compact {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: #ffffff;
      border-radius: 6px;
      border: 1px solid rgba(0, 0, 0, 0.08);
      margin-bottom: 8px;
    }

    .apoio-icon {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      flex-shrink: 0;
    }

    .apoio-controls {
      flex: 1;
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .apoio-select {
      flex: 1;
      padding: 6px 8px;
      font-size: 10px;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 4px;
    }

    .apoio-color-btn {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      cursor: pointer;
      position: relative;
    }

    .apoio-insert-btn {
      padding: 6px 12px;
      background: #4668FF;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
    }

    .apoio-insert-btn:hover {
      background: #2563eb;
    }

    /* Footer Checkbox */
    .footer-checkbox {
      margin-top: 20px;
      padding: 12px;
      background: #ffffff;
      border-radius: 6px;
      border: 1px solid rgba(0, 0, 0, 0.08);
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    .footer-checkbox input {
      width: 14px;
      height: 14px;
      cursor: pointer;
      accent-color: #4668FF;
    }

    .footer-checkbox label {
      font-size: 11px;
      color: #57534e;
      cursor: pointer;
    }

    /* Measure Icons */
    .measure-icon {
      width: 32px;
      height: 16px;
      border: 2px solid #e11d48;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .measure-icon::before,
    .measure-icon::after {
      content: '';
      position: absolute;
      width: 2px;
      height: 8px;
      background: #e11d48;
      top: -3px;
    }

    .measure-icon::before { left: -2px; }
    .measure-icon::after { right: -2px; }

    .measure-icon-text {
      font-size: 8px;
      font-weight: bold;
      color: #e11d48;
    }

    /* Gap Icon */
    .gap-icon {
      width: 32px;
      height: 16px;
      background: rgba(236, 72, 153, 0.15);
      border: 1px dashed #ec4899;
      border-radius: 2px;
    }

    /* Padding Icon */
    .padding-icon {
      width: 32px;
      height: 16px;
      background: rgba(14, 165, 233, 0.15);
      border: 1px dashed #0ea5e9;
      border-radius: 2px;
    }

    /* Pointer Icons */
    .pointer-icon {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }

    .pointer-dot {
      width: 6px;
      height: 6px;
      background: #FCFC30;
      border-radius: 50%;
    }

    .pointer-line-v {
      width: 1px;
      height: 10px;
      background: #FCFC30;
    }

    .pointer-number {
      width: 18px;
      height: 18px;
      background: #FCFC30;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 11px;
      color: #000;
    }

    /* Area Icons */
    .area-icon-circle {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(218, 160, 176, 0.3);
      border: 2px dashed #DAA0B0;
    }

    .area-icon-square {
      width: 20px;
      height: 20px;
      background: rgba(218, 160, 176, 0.3);
      border: 2px dashed #DAA0B0;
    }
  </style>
</head>
<body>
  <!-- MEDIDAS Section -->
  <div class="section-header">MEDIDAS</div>

  <div class="asset-buttons">
    <div class="asset-btn" onclick="selectMedida('measure')">
      <div class="asset-btn-icon">
        <div class="measure-icon">
          <span class="measure-icon-text">100</span>
        </div>
      </div>
      <div class="asset-btn-label">Medida</div>
    </div>

    <div class="asset-btn" onclick="selectMedida('gap')">
      <div class="asset-btn-icon">
        <div class="gap-icon"></div>
      </div>
      <div class="asset-btn-label">Gap</div>
    </div>

    <div class="asset-btn" onclick="selectMedida('padding')">
      <div class="asset-btn-icon">
        <div class="padding-icon"></div>
      </div>
      <div class="asset-btn-label">Padding</div>
    </div>
  </div>

  <div class="controls-row">
    <div class="control-group">
      <label class="control-label">Direção</label>
      <select class="control-select" id="medidasDirection">
        <option value="horizontal">Horizontal</option>
        <option value="vertical">Vertical</option>
      </select>
    </div>
    <div class="control-group">
      <label class="control-label">Posição Badge</label>
      <select class="control-select" id="medidasBadgePosition">
        <option value="bottom">Abaixo</option>
        <option value="top">Acima</option>
        <option value="left">Esquerda</option>
        <option value="right">Direita</option>
      </select>
    </div>
  </div>

  <!-- POINTERS Section -->
  <div class="section-header">POINTERS</div>

  <div class="asset-buttons pointers-grid">
    <div class="asset-btn" onclick="selectPointer('pointer-top')">
      <div class="asset-btn-icon">
        <div class="pointer-icon">
          <div class="pointer-dot"></div>
          <div class="pointer-line-v"></div>
        </div>
      </div>
      <div class="asset-btn-label">Top</div>
    </div>

    <div class="asset-btn" onclick="selectPointer('pointer-bottom')">
      <div class="asset-btn-icon">
        <div class="pointer-icon" style="flex-direction: column-reverse;">
          <div class="pointer-dot"></div>
          <div class="pointer-line-v"></div>
        </div>
      </div>
      <div class="asset-btn-label">Bottom</div>
    </div>

    <div class="asset-btn" onclick="selectPointer('pointer-left')">
      <div class="asset-btn-icon">
        <div class="pointer-icon" style="flex-direction: row;">
          <div class="pointer-dot"></div>
          <div class="pointer-line-v" style="width: 10px; height: 1px;"></div>
        </div>
      </div>
      <div class="asset-btn-label">Left</div>
    </div>

    <div class="asset-btn" onclick="selectPointer('pointer-right')">
      <div class="asset-btn-icon">
        <div class="pointer-icon" style="flex-direction: row-reverse;">
          <div class="pointer-dot"></div>
          <div class="pointer-line-v" style="width: 10px; height: 1px;"></div>
        </div>
      </div>
      <div class="asset-btn-label">Right</div>
    </div>
  </div>

  <div class="controls-row">
    <div class="control-group">
      <label class="control-label">Cor do Marcador</label>
      <div class="color-picker-row">
        <div class="color-preview" id="pointerMarkerColorPreview" style="background: #e11d48;"></div>
        <select class="control-select" id="pointerMarkerColorSelect" onchange="onPointerMarkerColorChange()" style="flex: 1;">
          <option value="red">Vermelho</option>
          <option value="blue">Azul</option>
          <option value="pink">Rosa</option>
          <option value="green">Verde</option>
          <option value="custom">Personalizar</option>
        </select>
      </div>
      <div class="color-input-wrapper" id="pointerMarkerCustomWrapper">
        <input type="text" class="color-hex-input" id="pointerMarkerCustomHex" placeholder="#FF0000" maxlength="7" oninput="onPointerMarkerCustomInput()">
      </div>
    </div>

    <div class="control-group">
      <label class="control-label">Cor do Texto</label>
      <div class="color-picker-row">
        <div class="color-preview" id="pointerTextColorPreview" style="background: #e11d48;"></div>
        <select class="control-select" id="pointerTextColorSelect" onchange="onPointerTextColorChange()" style="flex: 1;">
          <option value="inherit">Mesma do marcador</option>
          <option value="black">Preto</option>
          <option value="custom">Personalizar</option>
        </select>
      </div>
      <div class="color-input-wrapper" id="pointerTextCustomWrapper">
        <input type="text" class="color-hex-input" id="pointerTextCustomHex" placeholder="#000000" maxlength="7" oninput="onPointerTextCustomInput()">
      </div>
    </div>
  </div>

  <!-- APOIO Section -->
  <div class="section-header">APOIO</div>

  <!-- Pointers Numéricos -->
  <div class="apoio-compact">
    <div class="apoio-icon">
      <div class="pointer-number">1</div>
    </div>
    <div class="apoio-controls">
      <select class="apoio-select" id="apoioNumberDirection">
        <option value="number-top">Top</option>
        <option value="number-bottom">Bottom</option>
        <option value="number-left">Left</option>
        <option value="number-right">Right</option>
      </select>
      <div class="apoio-color-btn" id="apoioNumberColorBtn" style="background: #FCFC30;" onclick="openApoioNumberColorPicker()"></div>
      <button class="apoio-insert-btn" onclick="insertApoioNumber()">Inserir</button>
    </div>
  </div>

  <!-- Hidden color input for number -->
  <div class="color-input-wrapper" id="apoioNumberCustomWrapper">
    <input type="text" class="color-hex-input" id="apoioNumberCustomHex" placeholder="#FCFC30" maxlength="7" oninput="onApoioNumberCustomInput()">
  </div>

  <!-- Formas (Assets) -->
  <div class="apoio-compact">
    <div class="apoio-icon">
      <div class="area-icon-circle"></div>
    </div>
    <div class="apoio-controls">
      <select class="apoio-select" id="apoioAreaType">
        <option value="area-dashed-circle">Dashed Circle</option>
        <option value="area-dashed-square">Dashed Square</option>
        <option value="area-solid-circle">Solid Circle</option>
        <option value="area-solid-square">Solid Square</option>
      </select>
      <div class="apoio-color-btn" id="apoioAreaColorBtn" style="background: #DAA0B0;" onclick="openApoioAreaColorPicker()"></div>
      <button class="apoio-insert-btn" onclick="insertApoioArea()">Inserir</button>
    </div>
  </div>

  <!-- Hidden color input for area -->
  <div class="color-input-wrapper" id="apoioAreaCustomWrapper">
    <input type="text" class="color-hex-input" id="apoioAreaCustomHex" placeholder="#DAA0B0" maxlength="7" oninput="onApoioAreaCustomInput()">
  </div>

  <!-- Footer Checkbox -->
  <div class="footer-checkbox" onclick="toggleHighlight()">
    <input type="checkbox" id="globalHighlightMode">
    <label for="globalHighlightMode">On-Highlight</label>
  </div>

  <script>
    // State
    let selectedMedidaType = 'measure';
    let selectedPointerType = 'pointer-top';

    // Color maps
    const colorMap = {
      'red': '#e11d48',
      'blue': '#0ea5e9',
      'pink': '#ec4899',
      'green': '#2ec770',
      'black': '#000000'
    };

    // Medidas
    function selectMedida(type) {
      selectedMedidaType = type;
      document.querySelectorAll('.asset-buttons .asset-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.currentTarget.classList.add('active');
      insertMedida();
    }

    function insertMedida() {
      const direction = document.getElementById('medidasDirection').value;
      const badgePosition = document.getElementById('medidasBadgePosition').value;
      const highlightMode = document.getElementById('globalHighlightMode').checked;

      let colorType = 'red';
      if (selectedMedidaType === 'gap') colorType = 'pink';
      if (selectedMedidaType === 'padding') colorType = 'blue';

      parent.postMessage({
        pluginMessage: {
          type: 'insert-asset',
          assetType: selectedMedidaType,
          value: '100',
          colorType: colorType,
          direction: direction,
          badgePosition: badgePosition,
          highlightMode: highlightMode,
          size: 100
        }
      }, '*');
    }

    // Pointers
    function selectPointer(type) {
      selectedPointerType = type;
      document.querySelectorAll('.pointers-grid .asset-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.currentTarget.classList.add('active');
      insertPointer();
    }

    function insertPointer() {
      const markerColorSelect = document.getElementById('pointerMarkerColorSelect');
      const textColorSelect = document.getElementById('pointerTextColorSelect');
      const highlightMode = document.getElementById('globalHighlightMode').checked;

      let markerColor = markerColorSelect.value;
      if (markerColor === 'custom') {
        markerColor = document.getElementById('pointerMarkerCustomHex').value || '#FF0000';
      }

      let textColor = textColorSelect.value;
      if (textColor === 'custom') {
        textColor = document.getElementById('pointerTextCustomHex').value || '#000000';
      } else if (textColor === 'inherit') {
        textColor = undefined;
      }

      parent.postMessage({
        pluginMessage: {
          type: 'insert-asset',
          assetType: selectedPointerType,
          value: 'caption',
          colorType: markerColor,
          textColorType: textColor,
          highlightMode: highlightMode
        }
      }, '*');
    }

    // Pointer Marker Color
    function onPointerMarkerColorChange() {
      const select = document.getElementById('pointerMarkerColorSelect');
      const wrapper = document.getElementById('pointerMarkerCustomWrapper');
      const preview = document.getElementById('pointerMarkerColorPreview');

      if (select.value === 'custom') {
        wrapper.classList.add('visible');
      } else {
        wrapper.classList.remove('visible');
        preview.style.background = colorMap[select.value] || '#e11d48';
      }

      // Update text color preview if inherit
      updateTextColorPreview();
    }

    function onPointerMarkerCustomInput() {
      const input = document.getElementById('pointerMarkerCustomHex');
      const preview = document.getElementById('pointerMarkerColorPreview');
      let value = input.value.trim();

      // Auto-add # if missing
      if (value && !value.startsWith('#')) {
        value = '#' + value;
        input.value = value;
      }

      // Validate hex
      if (/^#[0-9A-Fa-f]{6}$/.test(value)) {
        preview.style.background = value;
        updateTextColorPreview();
      }
    }

    // Pointer Text Color
    function onPointerTextColorChange() {
      const select = document.getElementById('pointerTextColorSelect');
      const wrapper = document.getElementById('pointerTextCustomWrapper');

      if (select.value === 'custom') {
        wrapper.classList.add('visible');
      } else {
        wrapper.classList.remove('visible');
      }

      updateTextColorPreview();
    }

    function onPointerTextCustomInput() {
      const input = document.getElementById('pointerTextCustomHex');
      let value = input.value.trim();

      if (value && !value.startsWith('#')) {
        value = '#' + value;
        input.value = value;
      }

      updateTextColorPreview();
    }

    function updateTextColorPreview() {
      const textSelect = document.getElementById('pointerTextColorSelect');
      const textPreview = document.getElementById('pointerTextColorPreview');

      if (textSelect.value === 'inherit') {
        // Use marker color
        const markerSelect = document.getElementById('pointerMarkerColorSelect');
        if (markerSelect.value === 'custom') {
          const customHex = document.getElementById('pointerMarkerCustomHex').value;
          textPreview.style.background = /^#[0-9A-Fa-f]{6}$/.test(customHex) ? customHex : '#e11d48';
        } else {
          textPreview.style.background = colorMap[markerSelect.value] || '#e11d48';
        }
      } else if (textSelect.value === 'custom') {
        const customHex = document.getElementById('pointerTextCustomHex').value;
        textPreview.style.background = /^#[0-9A-Fa-f]{6}$/.test(customHex) ? customHex : '#000000';
      } else {
        textPreview.style.background = colorMap[textSelect.value] || '#000000';
      }
    }

    // Apoio - Number Pointers
    function openApoioNumberColorPicker() {
      const wrapper = document.getElementById('apoioNumberCustomWrapper');
      wrapper.classList.toggle('visible');
    }

    function onApoioNumberCustomInput() {
      const input = document.getElementById('apoioNumberCustomHex');
      const btn = document.getElementById('apoioNumberColorBtn');
      let value = input.value.trim();

      if (value && !value.startsWith('#')) {
        value = '#' + value;
        input.value = value;
      }

      if (/^#[0-9A-Fa-f]{6}$/.test(value)) {
        btn.style.background = value;
      }
    }

    function insertApoioNumber() {
      const direction = document.getElementById('apoioNumberDirection').value;
      const customHex = document.getElementById('apoioNumberCustomHex').value;
      const highlightMode = document.getElementById('globalHighlightMode').checked;

      let color = '#FCFC30'; // default yellow
      if (customHex && /^#[0-9A-Fa-f]{6}$/.test(customHex)) {
        color = customHex;
      }

      parent.postMessage({
        pluginMessage: {
          type: 'insert-asset',
          assetType: direction,
          value: '1',
          colorType: color,
          highlightMode: highlightMode,
          size: 25
        }
      }, '*');
    }

    // Apoio - Area Assets
    function openApoioAreaColorPicker() {
      const wrapper = document.getElementById('apoioAreaCustomWrapper');
      wrapper.classList.toggle('visible');
    }

    function onApoioAreaCustomInput() {
      const input = document.getElementById('apoioAreaCustomHex');
      const btn = document.getElementById('apoioAreaColorBtn');
      let value = input.value.trim();

      if (value && !value.startsWith('#')) {
        value = '#' + value;
        input.value = value;
      }

      if (/^#[0-9A-Fa-f]{6}$/.test(value)) {
        btn.style.background = value;
      }
    }

    function insertApoioArea() {
      const areaType = document.getElementById('apoioAreaType').value;
      const customHex = document.getElementById('apoioAreaCustomHex').value;
      const highlightMode = document.getElementById('globalHighlightMode').checked;

      let color = '#DAA0B0'; // default pink
      if (customHex && /^#[0-9A-Fa-f]{6}$/.test(customHex)) {
        color = customHex;
      }

      parent.postMessage({
        pluginMessage: {
          type: 'insert-asset',
          assetType: areaType,
          value: '28px',
          colorType: color,
          highlightMode: highlightMode,
          size: 28
        }
      }, '*');
    }

    // Global Highlight
    function toggleHighlight() {
      const checkbox = document.getElementById('globalHighlightMode');
      checkbox.checked = !checkbox.checked;
    }

    // Initialize
    updateTextColorPreview();
  </script>
</body>
</html>
